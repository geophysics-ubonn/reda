
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>reda.utils.electrode_manager &#8212; REDA 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery-rendered-html.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/reda_logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Reproducible electrical data analysis</p>








    

<p>
<a class="badge" href="https://travis-ci.org/geophysics-ubonn/reda">
    <img
        alt="https://secure.travis-ci.org/geophysics-ubonn/reda.svg?branch=master"
        src="https://secure.travis-ci.org/geophysics-ubonn/reda.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_containers.html">Data Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concept_electrodes.html">Concept: Electrode numbers and positions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filtering.html">Filtering Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging.html">Debugging reda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../importers.html">Data Importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test_data.html">Test data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/geophysics-ubonn/reda">Source code</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../reda.html">reda</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for reda.utils.electrode_manager</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">An electrode manager that deals with the relationships between electrode</span>
<span class="sd">numbers and electrode positions.</span>
<span class="sd">It can be used while importing data, but also to manage electrode positions for</span>
<span class="sd">data that does not come with actual electrode positions.</span>

<span class="sd">## Possible future features</span>

<span class="sd">## Implemented features</span>
<span class="sd">    * [done] Generate electrode numbers from a set of electrode coordinates</span>
<span class="sd">    * [done] Add new positions, including a .assume_regular_electrodes</span>
<span class="sd">      (spacing, axis=(x|y|z)) function that conforms electrode numbers to a</span>
<span class="sd">      fixed distance of electrodes.</span>
<span class="sd">    * [done] Assume reciprocal measurement by reversing</span>
<span class="sd">    * [done] The electrode numbering should follow an intuitive heuristic, i.e.</span>
<span class="sd">      from left to right, top to bottom (think of rhizotrons or borehole</span>
<span class="sd">      settings). This behavior should be changeable by means of a custom sort</span>
<span class="sd">      function that takes (x,z) or (x,y,z) tuples and returns a given order.</span>
<span class="sd">    * [done] 2D and 3D</span>
<span class="sd">    * [done] .from_existing_ordering(iterable(numbers), iterable(coordinates))</span>
<span class="sd">    * [done] reverse lookup: given a fixed electrode assignment table, return</span>
<span class="sd">    * [done] test/account for positions not registered yet, but for which an</span>
<span class="sd">      electrode number is requested electrode positions for given electrode</span>
<span class="sd">      numbers</span>
<span class="sd">    * [done] need proper tests for all sorters</span>
<span class="sd">    * [done] how to deal with incorrect electrode positions, e.g. for the case</span>
<span class="sd">      where default Syscal settings are used?</span>
<span class="sd">    * [done] Merge two datasets by their electrode coordinates:</span>


<span class="sd">## User Stories</span>

<span class="sd">1) Import Syscal Data with unused electrodes but correct electrode positions</span>

<span class="sd">Syscal data contains only electrode positions (x,y,z for binary, but often only</span>
<span class="sd">x coordinates for ascii export). As such we need to assign electrode numbers to</span>
<span class="sd">those coordinates. This is relatively straightforward in case all electrodes</span>
<span class="sd">attached to the multichannel system were used and a regular spacing was set in</span>
<span class="sd">the system. However, if electrodes were skipped, things can get messy.</span>

<span class="sd">Two possible procedures can now be employed:</span>

<span class="sd">A)</span>

<span class="sd">    1) Add all encountered electrode positions (for a,b,m,n) to the electrode</span>
<span class="sd">       manager.</span>
<span class="sd">    2) Sort the positions in ascending order for z,y,x coordinates (in</span>
<span class="sd">       ascending priority)</span>
<span class="sd">    3) (optional) add missing electrode positions to conform the resulting</span>
<span class="sd">       assignments to a fixed grid of electrodes, e.g., 48, 72, or 96</span>
<span class="sd">       electrodes.</span>
<span class="sd">    4) Use the resulting electrode number assignment to generate logical</span>
<span class="sd">       electrode numbers for a,b,m,n</span>

<span class="sd">B)</span>

<span class="sd">    1) Provide a precomputed assignment table for electrode numbers and</span>
<span class="sd">       positions to the electrode manager</span>
<span class="sd">    2) Use the resulting electrode number assignment to generate logical</span>
<span class="sd">       electrode numbers for a,b,m,n</span>


<span class="sd">2) Import Syscal Data with unused electrodes but incorrect electrode positions</span>

<span class="sd">Same as in (1), but use a replacement function to replace the incorrect</span>
<span class="sd">electrode positions with the correct ones.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="decorator_name_index"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.decorator_name_index">[docs]</a><span class="k">def</span> <span class="nf">decorator_name_index</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">rename_index</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;electrode_number&#39;</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">rename_index</span></div>


<div class="viewcode-block" id="electrode_manager"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager">[docs]</a><span class="k">class</span> <span class="nc">electrode_manager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="c1"># overview of built-in ordering schemes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ordering_schemes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;as_is&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_as_is</span><span class="p">,</span>
            <span class="s1">&#39;as_is_plus_one&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_as_is_plus_one</span><span class="p">,</span>
            <span class="s1">&#39;sort_coordinates_zyx&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_coords_ascending_xyz</span>
        <span class="p">}</span>

        <span class="c1"># if this is True, then we cannot change the electrode positions any</span>
        <span class="c1"># more. It used in case the user supplies her own assignment table</span>
        <span class="c1"># self.is_locked_down = False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_assigment_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_schemes</span><span class="p">[</span><span class="s1">&#39;as_is_plus_one&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_order_coords_ascending_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subdata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign electrode coordinates by sorting using increasing</span>
<span class="sd">        coordinates, with decreasing priority of z, y, x axes.</span>

<span class="sd">        Adjust the index to start at 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subdata : pandas.DataFrame</span>
<span class="sd">            Data to order (columns x,y,z)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coordinates_sorted : pandas.DataFrame</span>
<span class="sd">            Ordered columns x, y, z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coordinates_sorted</span> <span class="o">=</span> <span class="n">subdata</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">])</span>
        <span class="n">coordinates_sorted</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">coordinates_sorted</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coordinates_sorted</span>

    <span class="k">def</span> <span class="nf">_order_as_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subdata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign electrode numbers to coordinates in the order they were added</span>

<span class="sd">        Adjust the index to start at 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subdata : pandas.DataFrame</span>
<span class="sd">            Data to order (columns x,y,z)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coordinates_sorted : pandas.DataFrame</span>
<span class="sd">            Ordered columns x, y, z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coordinates_ordered</span> <span class="o">=</span> <span class="n">subdata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">coordinates_ordered</span>

    <span class="k">def</span> <span class="nf">_order_as_is_plus_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subdata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign electrode numbers to coordinates in the order they were added</span>

<span class="sd">        Adjust the index to start at 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subdata : pandas.DataFrame</span>
<span class="sd">            Data to order (columns x,y,z)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coordinates_sorted : pandas.DataFrame</span>
<span class="sd">            Ordered columns x, y, z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coordinates_ordered</span> <span class="o">=</span> <span class="n">subdata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">coordinates_ordered</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">coordinates_ordered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">coordinates_ordered</span>

<div class="viewcode-block" id="electrode_manager.register_custom_ordering_scheme"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.register_custom_ordering_scheme">[docs]</a>    <span class="k">def</span> <span class="nf">register_custom_ordering_scheme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a user-supplied function to assign electrode numbers to a</span>
<span class="sd">        given set of coordinates.</span>

<span class="sd">        The function must take one argument, a pandas.DataFrame with electrode</span>
<span class="sd">        coordinates in columns x,y,z. It then returns a ordered copy of that</span>
<span class="sd">        DataFrame, whose index values denote the electrode numbers. It is</span>
<span class="sd">        recommended to adjust the index to start with electrode number 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="n">function</span></div>

<div class="viewcode-block" id="electrode_manager.set_ordering_to_sort_zyx"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.set_ordering_to_sort_zyx">[docs]</a>    <span class="k">def</span> <span class="nf">set_ordering_to_sort_zyx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that activates the sorter that actually sorts</span>
<span class="sd">        electrode coordinates before assigning the electrode numbers.</span>
<span class="sd">        Useful to assign electrode numbers for automatically generated</span>
<span class="sd">        electrode numbers, such as encountered for some measurement systems.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_schemes</span><span class="p">[</span><span class="s1">&#39;sort_coordinates_zyx&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="electrode_manager.set_ordering_to_as_is"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.set_ordering_to_as_is">[docs]</a>    <span class="k">def</span> <span class="nf">set_ordering_to_as_is</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that activates the sorter that assigns electrode</span>
<span class="sd">        numbers in the order the coordinates were registered. Useful if</span>
<span class="sd">        coordinates are input by hand.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_schemes</span><span class="p">[</span><span class="s1">&#39;as_is&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="electrode_manager.set_ordering_to_as_is_plus_one"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.set_ordering_to_as_is_plus_one">[docs]</a>    <span class="k">def</span> <span class="nf">set_ordering_to_as_is_plus_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that activates the sorter that assigns electrode</span>
<span class="sd">        numbers in the order the coordinates were registered. Useful if</span>
<span class="sd">        coordinates are input by hand.</span>

<span class="sd">        This function will add 1 to the index values to ensure we do not zero</span>
<span class="sd">        index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_schemes</span><span class="p">[</span><span class="s1">&#39;as_is_plus_one&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="electrode_manager.add_fixed_assignments"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.add_fixed_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">add_fixed_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_raw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use a pre-determined electrode numbering scheme.</span>

<span class="sd">        This is accomplished by the following steps:</span>

<span class="sd">        1) clean all existing electrode positions already registered</span>
<span class="sd">        2) set a lock that prevents the addition of additional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ordering_to_as_is</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_raw</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;electrode_number&#39;</span> <span class="ow">in</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> \
            <span class="n">data_raw</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;electrode_number&#39;</span><span class="p">,</span> \
            <span class="s1">&#39;Column electrode_number must be present as column or named index&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;Column x must be present&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;Column y must be present&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;Column z must be present&#39;</span>

        <span class="k">if</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;electrode_number&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixed_assigment_table</span> <span class="o">=</span> <span class="n">data_raw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixed_assigment_table</span> <span class="o">=</span> <span class="n">data_raw</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;electrode_number&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fixed_sorter</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_assigment_table</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span> <span class="o">=</span> <span class="n">fixed_sorter</span></div>

<div class="viewcode-block" id="electrode_manager.add_by_position"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.add_by_position">[docs]</a>    <span class="k">def</span> <span class="nf">add_by_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_raw</span><span class="p">,</span> <span class="n">remove_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add electrodes by using only their positions (1D/2D/3D).</span>

<span class="sd">        Electrode positions are rounded to the self.round_to_decimals decimal</span>
<span class="sd">        to ensure we can do proper comparison and identification with the</span>
<span class="sd">        floats.</span>

<span class="sd">        Multiple formats are possible:</span>

<span class="sd">        1) pandas.DataFrame with columns (x/z) or (x/y/z)</span>
<span class="sd">        2) list (one position) or nested list (multiple positions)</span>
<span class="sd">        3) numpy array</span>

<span class="sd">        WARNING: For lists/tuples/arrays the number of supplied dimensions is</span>
<span class="sd">        determined by the second dimension after applying::</span>

<span class="sd">            nr_dimensions = np.atleast_2d(input_data).shape[1]</span>

<span class="sd">        As such, make sure to properly format 1d arrays!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_raw : numpy.ndarray|tuple|list</span>
<span class="sd">            Coordinate(s) for the electrodes to add to the pool</span>
<span class="sd">        remove_duplicates : bool, optional</span>
<span class="sd">            If True, only add coordinates not already registered</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_raw</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data_raw</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_raw</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">data_raw</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># assume only x coordinate</span>
                <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># assume only x/z coordinates</span>
                <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>

        <span class="k">assert</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;column x must be present&#39;</span>
        <span class="n">subdata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subdata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">subdata</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subdata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">subdata</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># make sure we have the correct order of columns before working with</span>
        <span class="c1"># numpy</span>
        <span class="n">subdata</span> <span class="o">=</span> <span class="n">subdata</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span>

        <span class="n">data_pre</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># add existing data</span>
            <span class="n">data_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># loop through new coordinates</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subdata</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">data_pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">already_there</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">data_pre</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data_pre</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data_pre</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">data_pre</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                                <span class="n">data_pre</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">already_there</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">data_pre</span><span class="p">,</span>
                            <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data_pre</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="electrode_manager.get_all_electrode_numbers"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.get_all_electrode_numbers">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_electrode_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the assignment between electrode numbers and coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span></div>

    <span class="nd">@property</span>
    <span class="nd">@decorator_name_index</span>
    <span class="k">def</span> <span class="nf">electrode_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">)</span>

    <span class="nd">@decorator_name_index</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">)</span>

<div class="viewcode-block" id="electrode_manager.get_electrode_numbers_for_positions"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.get_electrode_numbers_for_positions">[docs]</a>    <span class="k">def</span> <span class="nf">get_electrode_numbers_for_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions_raw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a given set of coordinates, return electrode coordinates</span>

<span class="sd">        In order to prevent problems with floating point representation and</span>
<span class="sd">        comparison, positions are rounded to the decimal given in</span>
<span class="sd">        self.round_to_decimals.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        position : numpy.ndarray|None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">positions_raw</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="p">),</span> <span class="s1">&#39;Positions must be given as lists, tuples, numpy arrays, or&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;a pandas.DataFrame&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions_raw</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">positions_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">positions_raw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">positions_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">positions_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">positions_np</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">positions_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">positions_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="p">))</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="n">positions_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">positions_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">positions_np</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">positions_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">positions_np</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">))</span><span class="o">.</span><span class="n">T</span>

            <span class="n">positions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">positions_np</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">positions_raw</span>

        <span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span>

        <span class="n">position</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="p">)[</span><span class="s1">&#39;electrode_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="c1"># import IPython</span>
        <span class="c1"># IPython.embed()</span>
        <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">position</span></div>

<div class="viewcode-block" id="electrode_manager.reflect_on_position_x"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.reflect_on_position_x">[docs]</a>    <span class="k">def</span> <span class="nf">reflect_on_position_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflect_on_x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reflect all electrode positions on a given x position::</span>

<span class="sd">            x_new = reflect_on_x - x_i</span>

<span class="sd">        This procedure modifies the actual position data and cannot be</span>
<span class="sd">        reversed.</span>

<span class="sd">        It is useful to treat reciprocal data measured with devices that can be</span>
<span class="sd">        configured to measure reciprocal data easily, while retaining the</span>
<span class="sd">        electrode coordinates of the normal spread (e.g., possible with the</span>
<span class="sd">        Iris Instruments Syscal devices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">[</span>
            <span class="s1">&#39;x&#39;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">reflect_on_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span></div>

<div class="viewcode-block" id="electrode_manager.conform_to_regular_x_spacing"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.conform_to_regular_x_spacing">[docs]</a>    <span class="k">def</span> <span class="nf">conform_to_regular_x_spacing</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">spacing_x</span><span class="p">,</span> <span class="n">nr_electrodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assume electrodes are located on a regular grid of electrodes with</span>
<span class="sd">        spacing spacing_x. Add missing electrode positions and thus ensure that</span>
<span class="sd">        the resulting electrode numbers conform to this full set of electrodes.</span>

<span class="sd">        This is useful when dealing with multiple measurements using</span>
<span class="sd">        multi-channel/multiplexer systems where not all electrodes are used in</span>
<span class="sd">        every measurement.</span>

<span class="sd">        This function works for simple setups - for specialized cases it is</span>
<span class="sd">        recommended to provide a complete electrode position list using the XXX</span>
<span class="sd">        method.</span>

<span class="sd">        Electrode positions are assumed to start at 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spacing_x : float</span>
<span class="sd">            Spacing of electrode meash</span>
<span class="sd">        nr_electrodes : int|None</span>
<span class="sd">            If set, only fill in electrode positions up to this electrode.</span>
<span class="sd">            Otherwise the maximal x position is used to determine the electrode</span>
<span class="sd">            number.</span>
<span class="sd">        y_level : float, optional</span>
<span class="sd">            y coordinate used for the additional points. Defaults to 0</span>
<span class="sd">        z_level : float, optional</span>
<span class="sd">            z coordinate used for the additional points. Defaults to 0</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception in case where existing electrode positions are not multiples</span>
<span class="sd">        of spacing_x.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if all existing positions fit</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">spacing_x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;spacing_x does not fit to all electrodes&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nr_electrodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">nr_electrodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing_x</span> <span class="o">+</span> <span class="n">spacing_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">new_positions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">new_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">spacing_x</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span>
        <span class="n">new_positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_level</span>
        <span class="n">new_positions</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_level</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_by_position</span><span class="p">(</span><span class="n">new_positions</span><span class="p">)</span></div>

<div class="viewcode-block" id="electrode_manager.get_position_of_number"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.get_position_of_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_position_of_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the position associated with a given electrode number.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;electrode numbers must be integers&#39;</span>
        <span class="n">electrode_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span>
        <span class="k">assert</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">electrode_positions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> \
            <span class="s1">&#39;electrode number not assigned yet&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">number</span><span class="p">]</span></div>

<div class="viewcode-block" id="electrode_manager.replace_coordinates_with_fixed_regular_grid_x"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.replace_coordinates_with_fixed_regular_grid_x">[docs]</a>    <span class="k">def</span> <span class="nf">replace_coordinates_with_fixed_regular_grid_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing_x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Using the current ordering scheme, replace the x coordinates with</span>
<span class="sd">        multiples of spaxing_x, starting with 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spacing_x : float</span>
<span class="sd">            New spacing of x coordinates</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span>

        <span class="n">new_x_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">old_coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">spacing_x</span><span class="p">,</span> <span class="n">spacing_x</span><span class="p">)</span>

        <span class="n">old_coordinates</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_x_coordinates</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span> <span class="o">=</span> <span class="n">old_coordinates</span></div>

<div class="viewcode-block" id="electrode_manager.replace_coordinate_of_electrode_number"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.replace_coordinate_of_electrode_number">[docs]</a>    <span class="k">def</span> <span class="nf">replace_coordinate_of_electrode_number</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">electrode_number</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace the coordinates of the given electrode number (in the</span>
<span class="sd">        current ordering) with the new coordinates.</span>

<span class="sd">        Note that, depending on the chosen ordering scheme this can lead to the</span>
<span class="sd">        electrode assignments changing. This is the case for the</span>
<span class="sd">        &#39;sort_coordinates_zyx&#39; scheme. However, &#39;as_is&#39; and &#39;as_is_plus_one&#39;</span>
<span class="sd">        will retain the electrode order.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        electrode_number : int</span>
<span class="sd">            The electrode number to replace</span>
<span class="sd">        coordinates : tuple|list|numpy.ndarray of size 2 or 3</span>
<span class="sd">            The new coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">electrode_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;electrode number must be an integer&#39;</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> \
            <span class="s1">&#39;coordinates must be of length 2 or 3&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coordinates_3d</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coordinates_3d</span> <span class="o">=</span> <span class="n">coordinates</span>

        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates_3d</span><span class="p">)</span>

        <span class="n">current_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span>

        <span class="k">assert</span> <span class="n">electrode_number</span> <span class="ow">in</span> <span class="n">current_positions</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> \
            <span class="s1">&#39;Electrode number not registered yet&#39;</span>

        <span class="n">old_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">electrode_number</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                <span class="n">old_coordinates</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_coords</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span></div>

<div class="viewcode-block" id="electrode_manager.plot_coordinates_x_z_to_ax"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.plot_coordinates_x_z_to_ax">[docs]</a>    <span class="k">def</span> <span class="nf">plot_coordinates_x_z_to_ax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">plot_electrode_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrode_positions</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">coordinates</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
            <span class="n">coordinates</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_electrode_numbers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">electrode_number</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">electrode_number</span><span class="p">),</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="electrode_manager.align_assignments"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.align_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">align_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">abmn1</span><span class="p">,</span> <span class="n">abmn2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Align the positions and logical electrode numbers of two datasets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos1 : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the electrode positions of the first dataset.</span>
<span class="sd">            Required columns: x, y, z and either a column &#39;electrode_number&#39; or</span>
<span class="sd">            an index named &#39;electrode_number&#39;.</span>
<span class="sd">        pos2 : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the electrode positions of the second dataset.</span>
<span class="sd">            Required columns: x, y, z and either a column &#39;electrode_number&#39; or</span>
<span class="sd">            an index named &#39;electrode_number&#39;.</span>
<span class="sd">        abmn1 : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the logical electrode numbers a,b,m,n for the</span>
<span class="sd">            data set 1.</span>
<span class="sd">        abmn2 : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the logical electrode numbers a,b,m,n for the</span>
<span class="sd">            data set 2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        electrode_positions_aligned : pandas.DataFrame</span>
<span class="sd">            Aligned electrode positions with new electrode numbers (index is</span>
<span class="sd">            named &#39;electrode_number&#39;).</span>
<span class="sd">        abmn1_aligned  : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the logical electrode numbers a,b,m,n of the</span>
<span class="sd">            first data set after merging (aligning) the electrode positions of</span>
<span class="sd">            both datasets.</span>
<span class="sd">        abmn2_aligned  : pandas.DataFrame</span>
<span class="sd">            Dataframe containing the logical electrode numbers a,b,m,n of the</span>
<span class="sd">            second data set after merging (aligning) the electrode positions of</span>
<span class="sd">            both datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos2</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">abmn1</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">abmn2</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">pos1</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">assert</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">pos1</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">assert</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">pos1</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">assert</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">pos2</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">assert</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">pos2</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">assert</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">pos2</span><span class="o">.</span><span class="n">columns</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">(</span><span class="n">abmn1</span><span class="p">,</span> <span class="n">abmn2</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">columns</span>

        <span class="n">pos1_rounded</span> <span class="o">=</span> <span class="n">pos1</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span>
        <span class="n">pos2_rounded</span> <span class="o">=</span> <span class="n">pos2</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_to_decimals</span><span class="p">)</span>

        <span class="n">elecs</span> <span class="o">=</span> <span class="n">electrode_manager</span><span class="p">()</span>
        <span class="n">elecs</span><span class="o">.</span><span class="n">add_by_position</span><span class="p">(</span><span class="n">pos1_rounded</span><span class="p">)</span>
        <span class="n">elecs</span><span class="o">.</span><span class="n">add_by_position</span><span class="p">(</span><span class="n">pos2_rounded</span><span class="p">)</span>
        <span class="c1"># print(&#39;merging here&#39;)</span>
        <span class="c1"># import IPython</span>
        <span class="c1"># IPython.embed()</span>

        <span class="k">if</span> <span class="n">pos1_rounded</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;electrode_number&#39;</span><span class="p">:</span>
            <span class="n">pos1_rounded</span> <span class="o">=</span> <span class="n">pos1_rounded</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pos2_rounded</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;electrode_number&#39;</span><span class="p">:</span>
            <span class="n">pos2_rounded</span> <span class="o">=</span> <span class="n">pos2_rounded</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">replacement_table1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">pos1_rounded</span><span class="p">,</span>
            <span class="n">elecs</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">replacement_table2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">pos2_rounded</span><span class="p">,</span>
            <span class="n">elecs</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">abmn1_aligned</span> <span class="o">=</span> <span class="n">abmn1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">replacement_table1</span><span class="p">[</span><span class="s1">&#39;electrode_number_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">replacement_table1</span><span class="p">[</span><span class="s1">&#39;electrode_number_y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>

        <span class="n">abmn2_aligned</span> <span class="o">=</span> <span class="n">abmn2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">replacement_table2</span><span class="p">[</span><span class="s1">&#39;electrode_number_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">replacement_table2</span><span class="p">[</span><span class="s1">&#39;electrode_number_y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">elecs</span><span class="p">(),</span> <span class="n">abmn1_aligned</span><span class="p">,</span> <span class="n">abmn2_aligned</span></div>

        <span class="c1"># import IPython</span>
        <span class="c1"># IPython.embed()</span>

<div class="viewcode-block" id="electrode_manager.shift_positions_xyz"><a class="viewcode-back" href="../../../_api/reda.utils.html#reda.utils.electrode_manager.electrode_manager.shift_positions_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">shift_positions_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift_by_xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shift electrode positions by adding the vector &#39;shift_by_xyz&#39; to</span>
<span class="sd">        each position.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shift_by_xyz : tuple|list|numpy.ndarray of size 1 or 2 or 3</span>
<span class="sd">            The vector to shift the data by. Length of 1 assumes that only the</span>
<span class="sd">            x coordinate of the vector differs from zero. Length of 2 assume a</span>
<span class="sd">            shift in (x,z) direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shift_by_xyz</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">shift</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;only one 1D array is accepted&#39;</span>

        <span class="k">if</span> <span class="n">shift</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">shift</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">shift</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shift</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">assert</span> <span class="n">shift</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;only arrays of length 1/2/3 are allowed&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_positions</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">shift</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021, M. Weigand and F. M. Wagner and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>