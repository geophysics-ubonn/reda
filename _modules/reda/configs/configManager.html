
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>reda.configs.configManager &#8212; REDA 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/reda_logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Reproducible electrical data analysis</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_containers.html">Data Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../importers.html">Data Importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../file_formats/example_tsert.html">TSERT â€“ Time Series ERT file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filtering.html">Filtering Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging.html">Debugging reda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test_data.html">Test data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/geophysics-ubonn/reda">Source code</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../reda.html">reda</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for reda.configs.configManager</h1><div class="highlight"><pre>
<span></span><span class="c1"># *-* coding: utf-8 *-*</span>
<span class="sd">&quot;&quot;&quot;Manage measurement configurations measurements.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">reda.utils.mpl</span>
<span class="kn">from</span> <span class="nn">reda.utils</span> <span class="kn">import</span> <span class="n">opt_import</span>

<span class="n">plt</span><span class="p">,</span> <span class="n">mpl</span> <span class="o">=</span> <span class="n">reda</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>


<div class="viewcode-block" id="ConfigManager"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager">[docs]</a><span class="k">class</span> <span class="nc">ConfigManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The class`ConfigManager` manages four-point measurement configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nr_of_electrodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># store the configs as a Nx4 numpy array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># each measurement can store additional data here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># number of electrodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span> <span class="o">=</span> <span class="n">nr_of_electrodes</span>

<div class="viewcode-block" id="ConfigManager.abmn_to_dataframe"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.abmn_to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">abmn_to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a pandas.DataFrame containing the measurement configurations</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        abmn_df : pandas.DataFrame</span>
<span class="sd">            Configurations in a DataFrame (columns: a,b,m,n)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abmn_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">abmn_df</span></div>

    <span class="k">def</span> <span class="nf">_get_next_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_counter</span>

<div class="viewcode-block" id="ConfigManager.clear_configs"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.clear_configs">[docs]</a>    <span class="k">def</span> <span class="nf">clear_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all configs. This implies deleting all measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nr_of_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return number of configurations</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nr_of_configs: int</span>
<span class="sd">            number of configurations stored in this instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_crmod_to_abmn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;convert crmod-style configurations to a Nx4 array</span>

<span class="sd">        CRMod-style configurations merge A and B, and M and N, electrode</span>
<span class="sd">        numbers into one large integer each:</span>

<span class="sd">        .. math ::</span>

<span class="sd">            AB = A \cdot 10^4 + B</span>

<span class="sd">            MN = M \cdot 10^4 + N</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: numpy.ndarray</span>
<span class="sd">            Nx2 array holding the configurations to convert</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from reda.configs.configManager import ConfigManager</span>
<span class="sd">        &gt;&gt;&gt; config = ConfigManager(nr_of_electrodes=5)</span>
<span class="sd">        &gt;&gt;&gt; crmod_configs = np.array((</span>
<span class="sd">        ...     (10002, 40003),</span>
<span class="sd">        ...     (10010, 30004),</span>
<span class="sd">        ... ))</span>
<span class="sd">        &gt;&gt;&gt; abmn = config._crmod_to_abmn(crmod_configs)</span>
<span class="sd">        &gt;&gt;&gt; print(abmn)   # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        [[ 1  2  4  3]</span>
<span class="sd">         [ 1 10  3  4]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ABMN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
            <span class="n">A</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
            <span class="n">B</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
            <span class="n">M</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
            <span class="n">N</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ABMN</span>

<div class="viewcode-block" id="ConfigManager.load_configs"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.load_configs">[docs]</a>    <span class="k">def</span> <span class="nf">load_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load configurations from a file with four columns: a b m n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.load_injections_from_mcf"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.load_injections_from_mcf">[docs]</a>    <span class="k">def</span> <span class="nf">load_injections_from_mcf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load injections from a mcf-file used by the sEIT-systems from FZJ;</span>
<span class="sd">        Injections in the file must be formatted like the following:</span>
<span class="sd">        SE 001 002</span>
<span class="sd">        SE 002 001</span>
<span class="sd">        .</span>
<span class="sd">        .</span>
<span class="sd">        .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: string</span>
<span class="sd">            absolute or relative path to a mcf-file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Nx2 numpy array with current injections</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">injections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># load all injections</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mcf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mcf</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SE&quot;</span><span class="p">:</span>
                    <span class="n">injections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>

        <span class="c1"># convert to array</span>
        <span class="n">injections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">injections</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># remove double entries because only one current injection</span>
        <span class="c1"># is needed for configs</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">injections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">injections</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">injections</span> <span class="o">=</span> <span class="n">injections</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">injections</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.load_crmod_config"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.load_crmod_config">[docs]</a>    <span class="k">def</span> <span class="nf">load_crmod_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a CRMod configuration file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: string</span>
<span class="sd">            absolute or relative path to a crmod config.dat file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">nr_of_configs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loaded configs:&#39;</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nr_of_configs</span> <span class="o">!=</span> <span class="n">configs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;indicated number of measurements does not equal &#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;to actual number of measurements&#39;</span><span class="p">)</span>
            <span class="n">ABMN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crmod_to_abmn</span><span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">ABMN</span></div>

<div class="viewcode-block" id="ConfigManager.load_crmod_or_4c_configs"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.load_crmod_or_4c_configs">[docs]</a>    <span class="k">def</span> <span class="nf">load_crmod_or_4c_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load configurations either from a CRMod measurement file, or from a</span>
<span class="sd">        four-column file. Assume 1-indexed data (start with electrode 1).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Path to file that shall be imported</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The first line decides</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first_line</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_configs</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">first_line</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_crmod_config</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;File format not recognized&#39;</span><span class="p">)</span></div>

    <span class="c1"># def load_crmod_volt(self, filename):</span>
    <span class="c1">#     &quot;&quot;&quot;Load a CRMod measurement file (commonly called volt.dat)</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     filename: string</span>
    <span class="c1">#         path to filename</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     list</span>
    <span class="c1">#         list of measurement ids</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     with open(filename, &#39;r&#39;) as fid:</span>
    <span class="c1">#         nr_of_configs = int(fid.readline().strip())</span>
    <span class="c1">#         measurements = np.loadtxt(fid)</span>
    <span class="c1">#         if nr_of_configs != measurements.shape[0]:</span>
    <span class="c1">#             raise Exception(</span>
    <span class="c1">#                 &#39;indicated number of measurements does not equal &#39; +</span>
    <span class="c1">#                 &#39;to actual number of measurements&#39;)</span>
    <span class="c1">#     ABMN = self._crmod_to_abmn(measurements[:, 0:2])</span>
    <span class="c1">#     if self.configs is None:</span>
    <span class="c1">#         self.configs = ABMN</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         # check that configs match</span>
    <span class="c1">#         if not np.all(ABMN == self.configs):</span>
    <span class="c1">#             raise Exception(</span>
    <span class="c1">#                 &#39;previously stored configurations do not match new &#39; +</span>
    <span class="c1">#                 &#39;configurations&#39;)</span>

    <span class="c1">#     # add data</span>
    <span class="c1">#     cid_mag = self.add_measurements(measurements[:, 2])</span>
    <span class="c1">#     cid_pha = self.add_measurements(measurements[:, 3])</span>
    <span class="c1">#     return [cid_mag, cid_pha]</span>

    <span class="k">def</span> <span class="nf">_get_crmod_abmn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a Nx2 array with the measurement configurations formatted</span>
<span class="sd">        CRTomo style</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ABMN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ABMN</span>

<div class="viewcode-block" id="ConfigManager.write_crmod_volt"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.write_crmod_volt">[docs]</a>    <span class="k">def</span> <span class="nf">write_crmod_volt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the measurements to the output file in the volt.dat file</span>
<span class="sd">        format that can be read by CRTomo.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: string</span>
<span class="sd">            output filename</span>
<span class="sd">        mid: int or [int, int]</span>
<span class="sd">            measurement ids of magnitude and phase measurements. If only one ID</span>
<span class="sd">            is given, then the phase column is filled with zeros</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ABMN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_crmod_abmn</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">mag_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pha_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">mid</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mag_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>
            <span class="n">pha_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">mag_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ABMN</span><span class="p">,</span> <span class="n">mag_data</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                              <span class="n">pha_data</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ABMN</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">all_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.write_crmod_volt_with_individual_errors"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.write_crmod_volt_with_individual_errors">[docs]</a>    <span class="k">def</span> <span class="nf">write_crmod_volt_with_individual_errors</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data_mids</span><span class="p">,</span> <span class="n">error_mids</span><span class="p">,</span> <span class="n">norm_mag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm_pha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ABMN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_crmod_abmn</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_mids</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">mag_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">data_mids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pha_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">data_mids</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">mag_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">error_mids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pha_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">error_mids</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Individual errors for mag-only not implemented yet&#39;</span><span class="p">)</span>
            <span class="n">mag_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">data_mids</span><span class="p">]</span>
            <span class="n">pha_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data_mids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">ABMN</span><span class="p">,</span>
                <span class="n">mag_data</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                <span class="n">pha_data</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                <span class="n">mag_error</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                <span class="n">pha_error</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> T</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ABMN</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">all_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">bytes</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">norm_mag</span><span class="p">,</span> <span class="n">norm_pha</span><span class="p">),</span>
                    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.write_crmod_config"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.write_crmod_config">[docs]</a>    <span class="k">def</span> <span class="nf">write_crmod_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the configurations to a configuration file in the CRMod format</span>
<span class="sd">        All configurations are merged into one previor to writing to file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: string</span>
<span class="sd">            absolute or relative path to output filename (usually config.dat)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ABMN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_crmod_abmn</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ABMN</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">ABMN</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.gen_dipole_dipole"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_dipole_dipole">[docs]</a>    <span class="k">def</span> <span class="nf">gen_dipole_dipole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">skipc</span><span class="p">,</span>
                          <span class="n">skipv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">stepc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">stepv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">nr_voltage_dipoles</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                          <span class="n">before_current</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">allow_crossings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">start_skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate dipole-dipole configurations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        skipc: int</span>
<span class="sd">            number of electrode positions that are skipped between electrodes</span>
<span class="sd">            of a given dipole</span>
<span class="sd">        skipv: int</span>
<span class="sd">            steplength between subsequent voltage dipoles. A steplength of 0</span>
<span class="sd">            will produce increments by one, i.e., 3-4, 4-5, 5-6 ...</span>
<span class="sd">        stepc: int</span>
<span class="sd">            steplength between subsequent current dipoles. A steplength of 0</span>
<span class="sd">            will produce increments by one, i.e., 3-4, 4-5, 5-6 ...</span>
<span class="sd">        stepv: int</span>
<span class="sd">            steplength between subsequent voltage dipoles. A steplength of 0</span>
<span class="sd">            will produce increments by one, i.e., 3-4, 4-5, 5-6 ...</span>
<span class="sd">        nr_voltage_dipoles: int</span>
<span class="sd">            the number of voltage dipoles to generate for each current</span>
<span class="sd">            injection dipole</span>
<span class="sd">        before_current: bool, optional</span>
<span class="sd">            if set to True, also generate voltage dipoles in front of current</span>
<span class="sd">            dipoles.</span>
<span class="sd">        allow_crossings : bool, optional</span>
<span class="sd">            Allow potential dipoles to cross current injection dipoles. Note</span>
<span class="sd">            that any quadpole generated by crossing the current electrodes is</span>
<span class="sd">            NOT counted into nr_voltage_dipoles.</span>
<span class="sd">        start_skip: int, optional</span>
<span class="sd">            how many electrode to skip before/after the first/second current</span>
<span class="sd">            electrode.</span>
<span class="sd">        N: int, optional</span>
<span class="sd">            number of electrodes, must be given if not already known by the</span>
<span class="sd">            config instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from reda.configs.configManager import ConfigManager</span>
<span class="sd">        &gt;&gt;&gt; config = ConfigManager(nr_of_electrodes=10)</span>
<span class="sd">        &gt;&gt;&gt; config.gen_dipole_dipole(skipc=2)</span>
<span class="sd">        array([[ 1,  4,  5,  8],</span>
<span class="sd">               [ 1,  4,  6,  9],</span>
<span class="sd">               [ 1,  4,  7, 10],</span>
<span class="sd">               [ 2,  5,  6,  9],</span>
<span class="sd">               [ 2,  5,  7, 10],</span>
<span class="sd">               [ 3,  6,  7, 10]])</span>

<span class="sd">        &gt;&gt;&gt; from reda.configs.configManager import ConfigManager</span>
<span class="sd">        &gt;&gt;&gt; config = ConfigManager(nr_of_electrodes=10)</span>
<span class="sd">        &gt;&gt;&gt; config.gen_dipole_dipole(</span>
<span class="sd">        ...     skipc=2, before_current=True, allow_crossings=True)</span>
<span class="sd">        array([[ 1,  4,  2,  5],</span>
<span class="sd">               [ 1,  4,  3,  6],</span>
<span class="sd">               [ 1,  4,  5,  8],</span>
<span class="sd">               [ 1,  4,  6,  9],</span>
<span class="sd">               [ 1,  4,  7, 10],</span>
<span class="sd">               [ 2,  5,  1,  4],</span>
<span class="sd">               [ 2,  5,  3,  6],</span>
<span class="sd">               [ 2,  5,  4,  7],</span>
<span class="sd">               [ 2,  5,  6,  9],</span>
<span class="sd">               [ 2,  5,  7, 10],</span>
<span class="sd">               [ 3,  6,  1,  4],</span>
<span class="sd">               [ 3,  6,  2,  5],</span>
<span class="sd">               [ 3,  6,  4,  7],</span>
<span class="sd">               [ 3,  6,  5,  8],</span>
<span class="sd">               [ 3,  6,  7, 10]])</span>

<span class="sd">        &gt;&gt;&gt; from reda.configs.configManager import ConfigManager</span>
<span class="sd">        &gt;&gt;&gt; config = ConfigManager(nr_of_electrodes=10)</span>
<span class="sd">        &gt;&gt;&gt; config.gen_dipole_dipole(skipc=1, before_current=True)</span>
<span class="sd">        array([[ 1,  3,  4,  6],</span>
<span class="sd">               [ 1,  3,  5,  7],</span>
<span class="sd">               [ 1,  3,  6,  8],</span>
<span class="sd">               [ 1,  3,  7,  9],</span>
<span class="sd">               [ 1,  3,  8, 10],</span>
<span class="sd">               [ 2,  4,  5,  7],</span>
<span class="sd">               [ 2,  4,  6,  8],</span>
<span class="sd">               [ 2,  4,  7,  9],</span>
<span class="sd">               [ 2,  4,  8, 10],</span>
<span class="sd">               [ 3,  5,  6,  8],</span>
<span class="sd">               [ 3,  5,  7,  9],</span>
<span class="sd">               [ 3,  5,  8, 10],</span>
<span class="sd">               [ 4,  6,  1,  3],</span>
<span class="sd">               [ 4,  6,  7,  9],</span>
<span class="sd">               [ 4,  6,  8, 10],</span>
<span class="sd">               [ 5,  7,  2,  4],</span>
<span class="sd">               [ 5,  7,  1,  3],</span>
<span class="sd">               [ 5,  7,  8, 10]])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;You must provide the number of electrodes&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span>

        <span class="c1"># by default, current voltage dipoles have the same size</span>
        <span class="k">if</span> <span class="n">skipv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skipv</span> <span class="o">=</span> <span class="n">skipc</span>

        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># current dipoles</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">skipv</span> <span class="o">-</span> <span class="n">skipc</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stepc</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">skipc</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># potential dipoles before current injection</span>
            <span class="k">if</span> <span class="n">before_current</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">start_skip</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">stepv</span><span class="p">):</span>
                    <span class="n">nr</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="n">nr_voltage_dipoles</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">skipv</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">quadpole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">allow_crossings</span><span class="p">:</span>
                    <span class="c1"># backward crossings</span>
                    <span class="n">electrodes_between_injections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">electrodes_between_injections</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">skipv</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">quadpole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">allow_crossings</span><span class="p">:</span>
                <span class="c1"># forward crossings</span>
                <span class="n">electrodes_between_injections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">electrodes_between_injections</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">skipv</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">quadpole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>

            <span class="c1"># potential dipoles after current injection</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">start_skip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">skipv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stepv</span><span class="p">):</span>
                <span class="n">nr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="n">nr_voltage_dipoles</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">skipv</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">quadpole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>

        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="c1"># now add to the instance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">configs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">,</span> <span class="n">configs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.gen_inner_gradients"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_inner_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">gen_inner_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injections</span><span class="p">,</span> <span class="n">skips</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a set of current injections, generate voltage dipoles between the</span>
<span class="sd">        current electrodes</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import reda</span>
<span class="sd">        &gt;&gt;&gt; cfg = reda.ConfigManager(nr_of_electrodes=10)</span>
<span class="sd">        &gt;&gt;&gt; cfg.gen_inner_gradients([1, 10], skips=[2, ])</span>
<span class="sd">        array([[ 1, 10,  2,  5],</span>
<span class="sd">               [ 1, 10,  3,  6],</span>
<span class="sd">               [ 1, 10,  4,  7],</span>
<span class="sd">               [ 1, 10,  5,  8],</span>
<span class="sd">               [ 1, 10,  6,  9]])</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        injections : Nx2 numpy.ndarray</span>
<span class="sd">            Current injections</span>
<span class="sd">        skips : None or iterable</span>
<span class="sd">            The skips to generate. None will generate all possible skips</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs : Nx4 numpy.ndarray</span>
<span class="sd">            The generated configurations</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">configs_raw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">injections</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">max_skip</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">skips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">use_skips</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_skip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_skips</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">skips</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">max_skip</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">skip</span> <span class="ow">in</span> <span class="n">use_skips</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">skip</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">skip</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">configs_raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">configs_raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.gen_gradient"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_gradient">[docs]</a>    <span class="k">def</span> <span class="nf">gen_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vskip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vstep</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate gradient measurements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        skip: int</span>
<span class="sd">            distance between current electrodes</span>
<span class="sd">        step: int</span>
<span class="sd">            steplength between subsequent current dipoles</span>
<span class="sd">        vskip: int</span>
<span class="sd">            distance between voltage electrodes</span>
<span class="sd">        vstep: int</span>
<span class="sd">            steplength between subsequent voltage dipoles</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span>
        <span class="n">quadpoles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">skip</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">skip</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="n">vskip</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vstep</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">vskip</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">quadpoles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">quadpoles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">configs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.gen_all_voltages_for_injections"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_all_voltages_for_injections">[docs]</a>    <span class="k">def</span> <span class="nf">gen_all_voltages_for_injections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injections_raw</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;For a given set of current injections AB, generate all possible</span>
<span class="sd">        unique potential measurements.</span>

<span class="sd">        After Noel and Xu, 1991, for N electrodes, the number of possible</span>
<span class="sd">        voltage dipoles for a given current dipole is :math:`(N - 2)(N - 3) /</span>
<span class="sd">        2`. This includes normal and reciprocal measurements.</span>

<span class="sd">        If current dipoles are generated with</span>
<span class="sd">        ConfigManager.gen_all_current_dipoles(), then :math:`N \cdot (N - 1) /</span>
<span class="sd">        2` current dipoles are generated. Thus, this function will produce</span>
<span class="sd">        :math:`(N - 1)(N - 2)(N - 3) / 4` four-point configurations ABMN, half</span>
<span class="sd">        of which are reciprocals (Noel and Xu, 1991).</span>

<span class="sd">        All generated measurements are added to the instance.</span>

<span class="sd">        Use ConfigManager.split_into_normal_and_reciprocal() to split the</span>
<span class="sd">        configurations into normal and reciprocal measurements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        injections : numpy.ndarray</span>
<span class="sd">            Kx2 array holding K current injection dipoles A-B</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs : numpy.ndarray</span>
<span class="sd">            Nax4 array holding all possible measurement configurations</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">injections_raw</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">injections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">injections_raw</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">injections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">injections_raw</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span>
        <span class="n">all_quadpoles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idipole</span> <span class="ow">in</span> <span class="n">injections</span><span class="p">:</span>
            <span class="c1"># sort current electrodes and convert to array indices</span>
            <span class="n">Ipoles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">idipole</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># voltage electrodes</span>
            <span class="n">velecs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># remove current electrodes</span>
            <span class="k">del</span> <span class="p">(</span><span class="n">velecs</span><span class="p">[</span><span class="n">Ipoles</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">del</span> <span class="p">(</span><span class="n">velecs</span><span class="p">[</span><span class="n">Ipoles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># permutate remaining</span>
            <span class="n">voltages</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">velecs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">voltage</span> <span class="ow">in</span> <span class="n">voltages</span><span class="p">:</span>
                <span class="n">all_quadpoles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idipole</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idipole</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">voltage</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">voltage</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">configs_unsorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_quadpoles</span><span class="p">)</span>
        <span class="c1"># sort AB and MN</span>
        <span class="n">configs_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">configs_unsorted</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">configs_unsorted</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">configs_sorted</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.gen_all_current_dipoles"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_all_current_dipoles">[docs]</a>    <span class="k">def</span> <span class="nf">gen_all_current_dipoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate all possible current dipoles for the given number of</span>
<span class="sd">        electrodes (self.nr_electrodes). Duplicates are removed in the process.</span>

<span class="sd">        After Noel and Xu, 1991, for N electrodes, the number of possible</span>
<span class="sd">        unique configurations is :math:`N \cdot (N - 1) / 2`. This excludes</span>
<span class="sd">        duplicates in the form of switches current/voltages electrodes, as well</span>
<span class="sd">        as reciprocal measurements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs : Nx2 numpy.ndarray</span>
<span class="sd">            all possible current dipoles A-B</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span>
        <span class="n">celecs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">AB_list</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">celecs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ab</span> <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">AB_list</span><span class="p">])</span>
        <span class="n">AB</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># now we need to filter duplicates</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AB</span></div>

<div class="viewcode-block" id="ConfigManager.remove_duplicates"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.remove_duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove duplicate entries from 4-point configurations. If no</span>
<span class="sd">        configurations are provided, then use self.configs. Unique</span>
<span class="sd">        configurations are only returned if configs is not None.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: Nx4 numpy.ndarray, optional</span>
<span class="sd">            remove duplicates from these configurations instead from</span>
<span class="sd">            self.configs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs_unique: Kx4 numpy.ndarray</span>
<span class="sd">            unique configurations. Only returned if configs is not None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">configs</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">configs_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">configs_unique</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">configs_unique</span></div>

<div class="viewcode-block" id="ConfigManager.gen_schlumberger"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_schlumberger">[docs]</a>    <span class="k">def</span> <span class="nf">gen_schlumberger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;generate one Schlumberger sounding configuration, that is, one set</span>
<span class="sd">        of configurations for one potential dipole MN.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M: int</span>
<span class="sd">            electrode number for the first potential electrode</span>
<span class="sd">        N: int</span>
<span class="sd">            electrode number for the second potential electrode</span>
<span class="sd">        a: int, optional</span>
<span class="sd">            stepping between subsequent voltage electrodes. If not set,</span>
<span class="sd">            determine it as a = abs(M - N)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs: Kx4 numpy.ndarray</span>
<span class="sd">            array holding the configurations</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            import reda.configs.configManager as CRconfig</span>
<span class="sd">            config = CRconfig.ConfigManager(nr_of_electrodes=40)</span>
<span class="sd">            config.gen_schlumberger(M=20, N=21)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span>

        <span class="n">nr_of_steps_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">nr_of_steps_right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nr_of_steps_left</span><span class="p">,</span> <span class="n">nr_of_steps_right</span><span class="p">)):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span>
            <span class="n">B</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.gen_wenner"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_wenner">[docs]</a>    <span class="k">def</span> <span class="nf">gen_wenner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate Wenner measurement configurations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a: int</span>
<span class="sd">            distance (in electrodes) between subsequent electrodes of each</span>
<span class="sd">            four-point configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs: Kx4 numpy.ndarray</span>
<span class="sd">            array holding the configurations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_electrodes</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">),</span> <span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.add_to_configs"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.add_to_configs">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add one or more measurement configurations to the stored</span>
<span class="sd">        configurations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs : list or numpy.ndarray</span>
<span class="sd">            list or array of configurations</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs : Kx4 numpy.ndarray</span>
<span class="sd">            array holding all configurations of this instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">,</span> <span class="n">configs</span><span class="p">))</span>

        <span class="c1"># make sure we store the configs as ints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span></div>

<div class="viewcode-block" id="ConfigManager.split_into_normal_and_reciprocal"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.split_into_normal_and_reciprocal">[docs]</a>    <span class="k">def</span> <span class="nf">split_into_normal_and_reciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">return_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split the stored configurations into normal and reciprocal</span>
<span class="sd">        measurements</span>

<span class="sd">        ** *Rule 1: the normal configuration contains the smallest electrode</span>
<span class="sd">        number of the four involved electrodes in the current dipole* **</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pad: bool, optional</span>
<span class="sd">            if True, add numpy.nan values to the reciprocals for non-existent</span>
<span class="sd">            measuremnts</span>
<span class="sd">        return_indices: bool, optional</span>
<span class="sd">            if True, also return the indices of normal and reciprocal</span>
<span class="sd">            measurments. This can be used to extract corresponding</span>
<span class="sd">            measurements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        normal: numpy.ndarray</span>
<span class="sd">            Nnx4 array. If pad is True, then Nn == N (total number of</span>
<span class="sd">            unique measurements). Otherwise Nn is the number of normal</span>
<span class="sd">            measurements.</span>
<span class="sd">        reciprocal: numpy.ndarray</span>
<span class="sd">            Nrx4 array. If pad is True, then Nr == N (total number of</span>
<span class="sd">            unique measurements). Otherwise Nr is the number of reciprocal</span>
<span class="sd">            measurements.</span>
<span class="sd">        nor_indices: numpy.ndarray, optional</span>
<span class="sd">            Nnx1 array containing the indices of normal measurements. Only</span>
<span class="sd">            returned if return_indices is True.</span>
<span class="sd">        rec_indices: numpy.ndarray, optional</span>
<span class="sd">            Nrx1 array containing the indices of normal measurements. Only</span>
<span class="sd">            returned if return_indices is True.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for simplicity, we create an array where AB and MN are sorted</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>

        <span class="n">ab_min</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">mn_min</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># rule 1</span>
        <span class="n">indices_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ab_min</span> <span class="o">&lt;</span> <span class="n">mn_min</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># now look for reciprocals</span>
        <span class="n">indices_used</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normal_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reciprocal_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reciprocal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices_normal</span><span class="p">:</span>
            <span class="n">indices_used</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">normal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">normal_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># look for reciprocal configuration</span>
            <span class="n">index_rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="c1"># A == M, B == N, M == A, N == B</span>
                <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_rec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pad</span><span class="p">:</span>
                <span class="n">reciprocal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_rec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">reciprocal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:])</span>
                <span class="n">indices_used</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">reciprocal_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_rec</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># take the first one</span>
                <span class="n">reciprocal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:])</span>
                <span class="n">reciprocal_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">duplicates</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">indices_used</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index_rec</span><span class="p">)</span>

        <span class="c1"># now determine all reciprocal-only parameters</span>
        <span class="n">set_all_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">set_used_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">indices_used</span><span class="p">)</span>
        <span class="n">reciprocal_only_indices</span> <span class="o">=</span> <span class="n">set_all_indices</span> <span class="o">-</span> <span class="n">set_used_indices</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">reciprocal_only_indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
                <span class="n">normal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">reciprocal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="n">reciprocals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reciprocal</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">normals</span><span class="p">,</span> <span class="n">reciprocals</span><span class="p">,</span> <span class="n">normal_indices</span><span class="p">,</span> <span class="n">reciprocal_indices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">normals</span><span class="p">,</span> <span class="n">reciprocals</span></div>

<div class="viewcode-block" id="ConfigManager.gen_reciprocals"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_reciprocals">[docs]</a>    <span class="k">def</span> <span class="nf">gen_reciprocals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generate reciprocal configurations, sort by AB, and optionally</span>
<span class="sd">        append to configurations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        append : bool</span>
<span class="sd">            Append reciprocals to configs (the default is False).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; cfgs = ConfigManager(nr_of_electrodes=5)</span>
<span class="sd">        &gt;&gt;&gt; nor = cfgs.gen_dipole_dipole(skipc=0)</span>
<span class="sd">        &gt;&gt;&gt; rec = cfgs.gen_reciprocals(append=True)</span>
<span class="sd">        &gt;&gt;&gt; print(cfgs.configs)</span>
<span class="sd">        [[1 2 3 4]</span>
<span class="sd">         [1 2 4 5]</span>
<span class="sd">         [2 3 4 5]</span>
<span class="sd">         [3 4 1 2]</span>
<span class="sd">         [4 5 1 2]</span>
<span class="sd">         [4 5 2 3]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Switch AB and MN</span>
        <span class="n">reciprocals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">copy</span><span class="p">()[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># # Sort by current dipoles</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">reciprocals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">reciprocals</span> <span class="o">=</span> <span class="n">reciprocals</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">,</span> <span class="n">reciprocals</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reciprocals</span></div>

<div class="viewcode-block" id="ConfigManager.gen_configs_permutate"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.gen_configs_permutate">[docs]</a>    <span class="k">def</span> <span class="nf">gen_configs_permutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">injections_raw</span><span class="p">,</span>
                              <span class="n">only_same_dipole_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">ignore_crossed_dipoles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create measurement configurations out of a pool of current</span>
<span class="sd">        injections.  Use only the provided dipoles for potential dipole</span>
<span class="sd">        selection. This means that we have always reciprocal measurements.</span>

<span class="sd">        Remove quadpoles where electrodes are used both as current and voltage</span>
<span class="sd">        dipoles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        injections_raw : Nx2 array</span>
<span class="sd">            current injections</span>
<span class="sd">        only_same_dipole_length : bool, optional</span>
<span class="sd">            if True, only generate permutations for the same dipole length</span>
<span class="sd">        ignore_crossed_dipoles : bool, optional</span>
<span class="sd">            If True, potential dipoles will be ignored that lie between current</span>
<span class="sd">            dipoles,  e.g. 1-4 3-5. In this case it is possible to not have</span>
<span class="sd">            full normal-reciprocal coverage.</span>
<span class="sd">        silent: bool, optional</span>
<span class="sd">            if True, do not print information on ignored configs (default:</span>
<span class="sd">            False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs : Nx4 array</span>
<span class="sd">            quadrupoles generated out of the current injections</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">injections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">injections_raw</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">injections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">injection</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
            <span class="n">dipole_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">injections</span><span class="p">[</span><span class="n">injection</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                                   <span class="n">injections</span><span class="p">[</span><span class="n">injection</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># select all dipole EXCEPT for the injection dipole</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">injection</span><span class="p">]):</span>
                <span class="n">test_dipole_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">injections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                                            <span class="n">injections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">only_same_dipole_length</span>
                        <span class="ow">and</span> <span class="n">test_dipole_length</span> <span class="o">!=</span> <span class="n">dipole_length</span><span class="p">):</span>  <span class="c1"># noqa: W503</span>
                    <span class="k">continue</span>
                <span class="n">quadpole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">injections</span><span class="p">[</span><span class="n">injection</span><span class="p">,</span> <span class="p">:],</span> <span class="n">injections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ignore_crossed_dipoles</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="c1"># check if we need to ignore this dipole</span>
                    <span class="c1"># Note: this could be wrong if electrode number are not</span>
                    <span class="c1"># ascending!</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">quadpole</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># noqa: W503</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A - ignoring&#39;</span><span class="p">,</span> <span class="n">quadpole</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">quadpole</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                          <span class="ow">and</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quadpole</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># noqa: W503</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B - ignoring&#39;</span><span class="p">,</span> <span class="n">quadpole</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># add very quadpole</span>
                    <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>

        <span class="c1"># check and remove double use of electrodes</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">quadpole</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">quadpole</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">quadpole</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]))):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ignoring quadrupole because of &#39;</span><span class="p">,</span>
                          <span class="s1">&#39;repeated electrode use:&#39;</span><span class="p">,</span> <span class="n">quadpole</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quadpole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_configs</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.remove_max_dipole_sep"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.remove_max_dipole_sep">[docs]</a>    <span class="k">def</span> <span class="nf">remove_max_dipole_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxsep</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove configurations with dipole separations higher than `maxsep`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maxsep : int</span>
<span class="sd">            Maximum separation between both dipoles (the default is 10).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="n">sep</span> <span class="o">&lt;=</span> <span class="n">maxsep</span><span class="p">]</span></div>

<div class="viewcode-block" id="ConfigManager.write_configs"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.write_configs">[docs]</a>    <span class="k">def</span> <span class="nf">write_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write configs to file in four columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigManager.to_pg_scheme"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.to_pg_scheme">[docs]</a>    <span class="k">def</span> <span class="nf">to_pg_scheme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the configuration to a pygimli measurement scheme</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        container: reda.containers.ERT.ERT</span>
<span class="sd">            an ERT data container (we take the electrode positions from here)</span>
<span class="sd">        positions = None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data: pybert.DataContainerERT</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            from reda.configs.configManager import ConfigManager</span>
<span class="sd">            configs = ConfigManager(nr_of_electrodes=48)</span>
<span class="sd">            new_configs = configs.gen_dipole_dipole(skipc=2)</span>
<span class="sd">            x = np.arange(0, 48, 1)</span>
<span class="sd">            z = np.ones(48) * -1</span>
<span class="sd">            y = np.zeros(48)</span>
<span class="sd">            xyz = np.vstack((x, y, z)).T</span>
<span class="sd">            scheme = configs.to_pg_scheme(positions=xyz)</span>
<span class="sd">            print(scheme)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;electrode positions are required for BERT export&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">electrodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;container does not contain electrode positions&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">positions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;only one of container OR positions must be provided&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elec_positions</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="n">positions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elec_positions</span> <span class="o">=</span> <span class="n">positions</span>

        <span class="n">opt_import</span><span class="p">(</span><span class="s2">&quot;pybert&quot;</span><span class="p">,</span> <span class="n">requiredFor</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">pybert</span>

        <span class="c1"># Initialize BERT DataContainer</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pybert</span><span class="o">.</span><span class="n">DataContainerERT</span><span class="p">()</span>

        <span class="c1"># Define electrodes (48 electrodes spaced by 0.5 m)</span>
        <span class="k">for</span> <span class="n">nr</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elec_positions</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">createSensor</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

        <span class="c1"># Define number of measurements</span>
        <span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s2">&quot;abmn&quot;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># account for zero indexing</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="s2">&quot;abmn&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">data</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># np.vstack([data.get(x).array() for x in (&quot;abmn&quot;)]).T</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ConfigManager.to_iris_syscal"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.to_iris_syscal">[docs]</a>    <span class="k">def</span> <span class="nf">to_iris_syscal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export to IRIS Instrument configuration file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Path to output filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="c1"># fprintf(fod, &#39;#\t X\t Y\t Z\n&#39;);</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\t</span><span class="s1"> X</span><span class="se">\t</span><span class="s1"> Y</span><span class="se">\t</span><span class="s1"> Z</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># fprintf(fod, &#39;%d\t %.1f\t %d\t %d\n&#39;, D&#39;);</span>
            <span class="c1"># loop over electrodes and assign increasing x-positions</span>
            <span class="c1"># TODO: use proper electrode positions, if available</span>
            <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">   </span><span class="si">{}</span><span class="s1">  0   0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nr</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">))</span>

            <span class="c1"># fprintf(fod, &#39;#\t A\t B\t M\t N\n&#39;);</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\t</span><span class="s1"> A</span><span class="se">\t</span><span class="s1"> B</span><span class="se">\t</span><span class="s1"> M</span><span class="se">\t</span><span class="s1"> N</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># fprintf(fod, &#39;%d\t %d\t %d\t %d\t %d\n&#39;, C&#39;);</span>
            <span class="k">for</span> <span class="n">nr</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">):</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">config</span><span class="p">))</span></div>

<div class="viewcode-block" id="ConfigManager.get_unique_current_injections"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.get_unique_current_injections">[docs]</a>    <span class="k">def</span> <span class="nf">get_unique_current_injections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all unique current injection electrode pairs</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from reda.configs.configManager import ConfigManager</span>
<span class="sd">        &gt;&gt;&gt; cfg = ConfigManager()</span>
<span class="sd">        &gt;&gt;&gt; cfg.nr_electrodes</span>
<span class="sd">        &gt;&gt;&gt; cfg.nr_electrodes = 10</span>
<span class="sd">        &gt;&gt;&gt; cfg.add_to_configs((</span>
<span class="sd">        ...     (1, 2, 3, 4),</span>
<span class="sd">        ...     (1, 2, 5, 6),</span>
<span class="sd">        ...     (7, 8, 9, 10)</span>
<span class="sd">        ... ))</span>
<span class="sd">        array([[ 1,  2,  3,  4],</span>
<span class="sd">               [ 1,  2,  5,  6],</span>
<span class="sd">               [ 7,  8,  9, 10]])</span>
<span class="sd">        &gt;&gt;&gt; cfg.get_unique_current_injections()</span>
<span class="sd">        array([[1, 2],</span>
<span class="sd">               [7, 8]])</span>

<span class="sd">        cfg = ConfigManager()</span>
<span class="sd">        cfg.get_unique_current_injections()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unique_injections : Nx2 numpy.ndarray</span>
<span class="sd">            Current injections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unique_injections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unique_current_injections</span><span class="p">()</span>

<div class="viewcode-block" id="ConfigManager.remove_reciprocals"><a class="viewcode-back" href="../../../_api/reda.configs.html#reda.configs.configManager.ConfigManager.remove_reciprocals">[docs]</a>    <span class="k">def</span> <span class="nf">remove_reciprocals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">configs_to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs_to_use</span> <span class="o">=</span> <span class="n">configs</span>

        <span class="n">indices_to_delete</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">configs_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">configs_to_use</span><span class="p">)</span>

        <span class="n">configs_ar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">configs_ar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">configs_ar</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">configs_ar</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">configs_ar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="c1"># print(&#39;Checking&#39;, index, configs_ar[index, :])</span>
            <span class="c1"># normalized reciprocal</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">configs_ar</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">configs_ar</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">mr</span> <span class="o">=</span> <span class="n">configs_ar</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">configs_ar</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># we only search in lower indices</span>
            <span class="n">subdata</span> <span class="o">=</span> <span class="n">configs_ar</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">(</span><span class="n">subdata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ar</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">subdata</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">br</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">subdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">mr</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">subdata</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">nr</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># print(&#39;search&#39;, search)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indices_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># print(indices_to_delete)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">indices_to_delete</span><span class="p">)):</span>
            <span class="n">configs_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">configs_ar</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># write back</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">configs_ar</span>

        <span class="k">return</span> <span class="n">configs_ar</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, M. Weigand and F. M. Wagner and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>